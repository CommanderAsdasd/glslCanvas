<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>GlslCanvas</title>

        <script type="text/javascript" src="src/GlslCanvas.min.js"></script>
        <script type="text/javascript" src="src/fetch.js"></script>

        <style>
            body {
                background: #101515;
            }

            #glslCanvas {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%,-50%);
            }â€‹
        </style>

    </head>
    <body>
        <canvas id="glslCanvas" data-fragment-url="data/moon.frag" data-textures="data/moon.jpg" width="800" height="600"></canvas>
    </body>

    <script>
        function parseQuery (qstr) {
            var query = {};
            var a = qstr.split('&');
            for (var i in a) {
                var b = a[i].split('=');
                query[decodeURIComponent(b[0])] = decodeURIComponent(b[1]);
            }
            return query;
        }

        function load(url) {
            // Make the request and wait for the reply
            fetch(url)
                .then(function (response) {
                    // If we get a positive response...
                    if (response.status !== 200) {
                        console.log('Error getting shader. Status code: ' + response.status);
                        return;
                    }
                    // console.log(response);
                    return response.text();
                })
                .then(function(content) {
                    sandbox.load(content);
                })
        }

        var canvas = document.getElementById("glslCanvas");
        var sandbox = new GlslCanvas(canvas);
        var texCounter = 0;
        canvas.style.width = '100%';
        canvas.style.height = '100%';

        var query = parseQuery(window.location.search.slice(1));
        if (query && query.log) {
            load('http://thebookofshaders.com/log/' + query.log + '.frag');
        }

        if (window.location.hash !== '') {
            var hashes = location.hash.split('&');
            for (var i in hashes) {
                var ext = hashes[i].substr(hashes[i].lastIndexOf('.') + 1);
                var path = hashes[i];

                // Extract hash if is present
                if (path.search('#') === 0) {
                    path = path.substr(1);
                }

                if (ext === 'frag') {
                    load(path);
                }
                else if (ext === 'png' || ext === 'jpg' || ext === 'PNG' || ext === 'JPG') {
                    sandbox.setUniform("u_tex"+texCounter.toString(), path);
                    texCounter++;
                }
            }
        }

        if (texCounter === 0) {
            sandbox.setUniform("u_logo","data/logo.jpg");
        }
        
    </script>
</html>